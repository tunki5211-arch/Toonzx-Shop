<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROBLOX SHOP</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>üß± ROBLOX ITEM SHOP</h1>
</header>

<div class="container" id="products"></div>

<div class="bill">
  <input id="coupon" placeholder="‡πÉ‡∏™‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á">
  <button onclick="applyCoupon()">‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
  <p id="msg"></p>
  <h3>‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</h3>
</div>

<script type="module">
import { db } from "./firebase.js";
import { collection, getDocs } from 
"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

let cart=[], total=0;

const productsRef = await getDocs(collection(db,"products"));
productsRef.forEach(doc=>{
  const p = doc.data();
  products.innerHTML += `
  <div class="card">
    <h3>${p.name}</h3>
    <p>${p.price} ‡∏ö‡∏≤‡∏ó</p>
    <button onclick='add("${p.name}",${p.price})'>‡∏ã‡∏∑‡πâ‡∏≠</button>
  </div>`;
});

window.add = (name,price)=>{
  cart.push({name,price});
  total+=price;
  totalEl();
};

function totalEl(){ total.innerText = total; }

window.applyCoupon = async()=>{
  const code=coupon.value.toUpperCase();
  const snap = await getDocs(collection(db,"coupons"));
  snap.forEach(d=>{
    const c=d.data();
    if(c.code===code){
      cart.forEach(i=>{
        if(c.products.includes(i.name)){
          i.price -= i.price*(c.discount/100);
        }
      });
      total = cart.reduce((s,i)=>s+i.price,0);
      msg.innerText="‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß";
      totalEl();
    }
  });
};
</script>
</body>
</html>
